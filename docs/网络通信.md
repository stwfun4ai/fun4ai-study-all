OSI和TCP/IP对比

应用层协议讲解

传输控制层及SOCKET

网络层及链路层原理

NAT及路由规划



开放式系统互联通信参考模型（英语：Open System Interconnection Reference Model，缩写为 *OSI*）

# 系统调用

![0_1325744597WM32](D:\Java\document\study\images\osi-7层模型.gif)

- **用户**
  - **应用层**
  - 表示层
  - 会话层
- **内核**
  - **传输控制层**
  - **网络层**
  - **链路层**
  - **物理层**

> 物理层：**网卡，网线，集线器，中继器，调制解调器**
>
> 数据链路层：**网桥，交换机**
>
> 网络层：**路由器**
>
> **网关**工作在第四层传输层及其以上









```bash
#linux一切皆文件 socket tcp 
#8代表fd,<>代表输入流输出流
exec 8<> /dev/tcp/www.baidu.com/80

#>到文件 >&到fd
echo -e "GET /http/1.0\n" 1>& 8
cat 0<& 8

#查看socket
cd /proc/$$/fd
```



# 第7层 应用层 

**Application Layer**

- **用户接口**：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系。
- **实现各种服务**：该层具有的各种应用程序可以完成和实现用户请求的各种服务。



**HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP**



# 第6层 表示层

**Presentation Layer**

- **数据格式处理**：协商和建立数据交换的格式，解决各应用程序之间在数据格式表示上的差异。
- **数据的编码**：处理字符集和数字的转换。例如由于用户程序中的数据类型（整型或实型、有符号或无符号等）、用户标识等都可以有不同的表示方式，因此，在设备之间需要具有在不同字符集或格式之间转换的功能。
- **压缩和解压缩**：为了减少数据的传输量，这一层还负责数据的压缩与恢复。
- **数据的加密和解密**：可以提高网络的安全性。

# 第5层 会话层

**Session Layer**

- **会话管理**：允许用户在两个实体设备之间建立、维持和终止会话，并支持它们之间的数据交换。例如提供单方向会话或双向同时会话，并管理会话中的发送顺序，以及会话所占用时间的长短。
- **会话流量控制**：提供会话流量控制和交叉会话功能。
- **寻址**：使用远程地址建立会话连接。
- **出错控制**：从逻辑上讲会话层主要负责数据交换的建立、保持和终止，但实际的工作却是接收来自传输层的数据，并负责纠正错误。会话控制和远程过程调用均属于这一层的功能。但应注意，此层检查的错误不是通信介质的错误，而是磁盘空间、打印机缺纸等类型的高级错误。

# 第4层 传输层 

 **Transport Layer**

提供了主机应用程序进程之间的端到端的服务，基本功能如下：

- 分割与重组数据
- 按端口号寻址
- 连接管理
- 差错控制和流量控制 ,纠错的功能

传输层要向会话层提供通信服务的可靠性，避免报文的出错、丢失、延迟时间紊乱、重复、乱序等差错。



**UDP TCP**

## tcp

Transfer Control Protocol 传输==控制==协议

1. **面向==连接==**		

2. **可靠的传输**

   确认机制保证



三次握手--》数据传输--》四次分手

### 三次握手

![img](D:\Java\document\study\images\三次握手.png)

sync->sync ack -> ack	

client server都有资源的开辟

### 四次分手

![img](D:\Java\document\study\images\四次分手.png)



**抓包**

```bash
#需要安装tcpdump 添加-X参数测试
tcpdump -nn -i eth0 port 80

curl www.baidu.com
```

### 总结

**==三次握手和四次分手不可被分割！==**



高并发负载均衡	LVS 4层负载均衡器





## socket

Socket其实并不是一个协议，而是为了方便使用TCP或UDP而抽象出来的一层，是位于应用层和传输控制层之间的一组接口。Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。当两台主机通信时，必须通过Socket连接，Socket则利用TCP/IP协议建立TCP连接。TCP连接则更依靠于底层的IP协议，IP协议的连接则依赖于链路层等更低层次。WebSocket则是一个典型的应用层协议。Socket是传输控制层协议，WebSocket是应用层协议。



**成对出现**	IP+PORT -->  IP+PORT

ip:主机

port:进程/线程



服务端：22 8080 80

客户端：随机 65535



socket -> fd数字 -> worker进程

多个socket对应一个进程：多路复用器epoll



# 第3层 网络层

**Network Layer**



- **寻址**	IP	(进行逻辑地址寻址)
  - 网络号
  - 机号
- **路由**    route   (实现不同网络之间的路径选择)



```bash
vi /etc/sysconfig/network-scripts/ifcfg-eth0
```

ip地址点之间表示一个字节8位2^8-1=255

ip与掩码按位与得到**网络号**如192.168.150，后面就是局域网哪台机器（**机号**）



```bash
route -n
```

路由

互联网	**==下一跳==**









# 第2层 数据链路层

**Data Link Layer**

- **介质访问控制（MAC）**

  ​		解决共享型网络中多用户对信道竞争的问题，完成网络介质的访问控制。

- **逻辑链路控制（LLC）**

  ​		建立和维护网络连接，执行差错校验、流量控制和链路控制。





```bash
arp -a
```

mac地址



抓包

```bash
arp -a
arp -d 192.168.150.2 && curl www,baidu,com
```

新开连接

```bash
tcpdump -nn -i eth0 port 80 or arp
```







# 第1层 物理层

**Physical Layer**







































